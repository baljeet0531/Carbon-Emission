<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta property="og:title" content="Carbon">
    <meta property="og:image" content="./src/co2_icon.jpg">
    <meta property="og:description" content="Carbon">

    <link href="./src/style.css" rel="stylesheet" type="text/css">
    <link href="./src/register.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=DM Sans' rel='stylesheet'>
    <link rel="icon" type="image/jpeg" href="./src/co2_icon.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="./src/co2_icon.jpg" />
    <link rel="manifest" href="./manifest.json">

    <title>Carbon</title>
</head>
<meta>

<body>
    <div id="login_page">
        <p id="describe">將學生證拍照後再按下掃瞄照片</p>
        <div id="camera">
            <video id="scanner" width="1080px" height="720px">Video stream not avalible.</video>
        </div>
        <input type="range" hidden />
        <canvas id="snap"></canvas>
        <button id="to_canvas_btn" onclick="takePhoto()">拍攝照片</button>
        <button id="scan_btn" onclick="scanImage()">掃瞄照片</button>
        <p id="result"></p>
        <div class="btn_grid">
            <p class="next_btn" onclick="loginConfirm()">確認</p>
        </div>
    </div>

    <div id="register_page">
        <div id="agreement" class="regPage fade">
            <div id="welcome_text">
                <p id="IDandName">歡迎 E14056300方柏翔 的加入！</p>
            </div>
            <div id="agreement_content">
                <p>I. 本人已詳閱並充分了解CARBON－－隱私權政策所述內容，並同意及授權CARBON－－依此為本人個人資料之蒐集、處理、利用。</p>
                <p>II.
                    本人充分暸解CARBON－－於提供服務之過程中，將不可避免地接受不具備個人識別性之相關資訊，包括但不限於CARBON－－使用里程、地理位置、即時定位等（下稱「使用資訊」），本人同意及授權CARBON－－蒐集使用上述不具備個人識別性之資訊，或是將其與具可識別性之
                </p>
            </div>
            <div id="checkBox_div">
                <input type="checkbox" id="checkBox" onclick="showNext('')">
                <p>我已詳閱上述文字並同意</p>
            </div>
        </div>
        <div id="questionnaireStart" class="regPage fade">
            <p id="beforeStart">開始使用前，<br>我們先來做個簡單的調查！</p>
            <div class="btn_grid">
                <p class="next_btn" onclick="showNext('')">下一頁</p>
            </div>
        </div>
        <div id="questionnaireSchoolVehicle" class="regPage fade">
            <p class="questionnaireTitle">我平常上學的交通工具是</p>
            <div class="option_grid">
                <div class="option schoolVehicle" onclick="select(this)">
                    <img src="./src/walk.png">
                </div>
                <div class="option schoolVehicle" onclick="select(this)">
                    <img src="./src/bicycle.png">
                </div>
                <div class="option schoolVehicle" onclick="select(this)">
                    <img src="./src/car.png">
                </div>
                <div class="option schoolVehicle" onclick="select(this)">
                    <img src="./src/motorcycle.png">
                </div>
            </div>
            <div class="btn_grid">
                <p class="back_btn" onclick="showPrev()">上一題</p>
                <p class="next_btn" onclick="showNext('SchoolVehicle')">下一題</p>
            </div>
        </div>
        <div id="questionnaireLongDistanceFrequecy" class="regPage fade">
            <p class="questionnaireTitle">我長途移動(跨縣市)的頻率是</p>
            <div id="freq_input_div">
                <p>每個月</p>
                <input type="number" min="0" max="100" placeholder="0~100" oninput="validity.valid||(value='');">
                <p>次</p>
            </div>
            <div class="btn_grid">
                <p class="back_btn" onclick="showPrev()">上一題</p>
                <p class="next_btn" onclick="showNext('frequency')">下一題</p>
            </div>
        </div>
        <div id="questionnaireLongDistanceVehicle" class="regPage fade">
            <p class="questionnaireTitle">我長途移動(跨縣市)的交通工具是</p>
            <div class="option_grid">
                <div class="option longDistanceVehicle" onclick="select(this)">
                    <img src="./src/airplane.png">
                </div>
                <div class="option longDistanceVehicle" onclick="select(this)">
                    <img src=" ./src/bus1.png">
                </div>
                <div class="option longDistanceVehicle" onclick="select(this)">
                    <img src=" ./src/train.png">
                </div>
                <div class="option longDistanceVehicle" onclick="select(this)">
                    <img src=" ./src/THSR.png">
                </div>
            </div>
            <div class="btn_grid">
                <p class="back_btn" onclick="showPrev()">上一題</p>
                <p class="next_btn" onclick="showNext('longDistanceVehicle')">完成</p>
            </div>
        </div>
        <div id="importStep1-4" class="regPage fade">
            <a href="https://takeout.google.com/settings/takeout/custom/location_history"
                target="_blank">"https://takeout.google.com/settings/takeout/custom/location_history"</a>
            <div class="btn_grid">
                <p class="back_btn" onclick="showPrev()">上一題</p>
                <p class="next_btn" onclick="showHomepage('register')">完成</p>
            </div>
        </div>
    </div>


    <div id="navigation_bar">
        <img id="menu_icon" src="./src/menu.png">
    </div>

    <div id="home_div" class="main_frame">
        <div id="daily_info_page" class="mySlides fade">
            <div id="vice_info">
                <p id="daily_distance_title">今日移動距離</p>
                <p id="weekly_co2e_title">週累積碳排</p>
                <p id="daily_distance_value">76 km</p>
                <p id="weekly_co2e_value">9.8 kg CO<sub>2</sub>e</p>
            </div>
            <div id="main_info">
                <p id="weekday">SUN</p>
                <p id="daily_co2e_title">今日移動碳排</p>
                <p id="daily_co2e_value">34</p>
                <p id="daily_co2e_unit">kg CO<sub>2</sub>e</p>
            </div>
        </div>
        <div id="piechart_page" class="mySlides fade">
            <div id="chart_btn_div">
                <div id="today_chart_button">
                    <p class="button">今日</p>
                </div>
                <div id="weekly_chart_button">
                    <p class="button">本週</p>
                </div>
            </div>
            <div id="chart_div"></div>
        </div>
        <div id="daily_checkin_page" class="mySlides fade">
            <div id="cont_text_div">
                <p id="cont_text">已連續<span id="cont_number">4</span>天</p>
            </div>
            <table id="checkin_table">
                <caption>簽到表</caption>
                <tr>
                    <th>MON</th>
                    <th>TUE</th>
                    <th>WED</th>
                    <th>THU</th>
                    <th>FRI</th>
                    <th>SAT</th>
                    <th>SUN</th>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
                <tr>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                    <td><img src="./src/check.png"></td>
                </tr>
            </table>
        </div>
        <div id="dot_div" style="text-align:center">
            <span class="dot" onclick="currentSlide(1)"></span>
            <span class="dot" onclick="currentSlide(2), drawDonut()"></span>
            <span class="dot" onclick="currentSlide(3), drawTable()"></span>
        </div>
    </div>
    <div id="notification_div" class="main_frame">
        <div id="weekly_mission" class="notification_type">
            <div class="border"></div>
            <p class="notifi_title">本週任務</p>
            <p class="notifi_content">行走移動佔總移動40%</p>
        </div>
        <div id="rookie_mission" class="notification_type">
            <div class="border"></div>
            <p class="notifi_title">新手任務</p>
        </div>
        <div id="get_reward_" class="notification_type">
            <div class="border"></div>
            <p class="notifi_title">獎勵領取</p>
        </div>
        <div id="rank_notify" class="notification_type">
            <div class="border"></div>
            <p class="notifi_title">排行通知</p>
        </div>
    </div>
    <div id="reward_div" class="main_frame">
        <div class="reward">
            <div class="border"></div>
            <p class="reward_title">健身房免費使用 乙次</p>
            <p class="reward_expire_date">使用期限: 2022/04/21</p>
        </div>
    </div>
    <div id="rank_div" class="main_frame">
        <div id="rank_btn_div">
            <div id="department_rank_button">
                <p class="button">系級</p>
            </div>
            <div id="personal_rank_button">
                <p class="button">個人</p>
            </div>

        </div>
        <table id="rank_table">
            <tr>
                <th id="ranking_title">
                    <p>排名</p>
                </th>
                <th id="name_title">
                    <p>名字</p>
                </th>
                <th id="CE_title">
                    <p>總碳排</p>
                </th>
            </tr>
            <tr>
                <td><img src="./src/1st.png"></td>
                <td>
                    <p>程小清</p>
                </td>
                <td>
                    <p>0.38kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/2nd.png"></td>
                <td>
                    <p>朱晴晴</p>
                </td>
                <td>
                    <p>0.4kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/3rd.png"></td>
                <td>
                    <p>王大華</p>
                </td>
                <td>
                    <p>0.55kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/4th.png"></td>
                <td>
                    <p>陳小明</p>
                </td>
                <td>
                    <p>0.89kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/5th.png"></td>
                <td>
                    <p>黃小新</p>
                </td>
                <td>
                    <p>1.06kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/6th.png"></td>
                <td>
                    <p>許小澄</p>
                </td>
                <td>
                    <p>1.23kg/CO2e</p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/7th.png"></td>
                <td>
                    <p></p>
                </td>
                <td>
                    <p></p>
                </td>
            </tr>
            <tr>
                <td><img src="./src/8th.png"></td>
                <td>
                    <p></p>
                </td>
                <td>
                    <p></p>
                </td>
            </tr>
        </table>
    </div>
    <div id="knowledge_div" class="main_frame">
        <div class="knowledge">
            <div class="border">
            </div>
            <p class="knowledge_title">循環週報</p>
            <p class="knowledge_content"></p>
        </div>
    </div>
    <div id="QA_div" class="main_frame">
        <div class="QA">
            <div class="question">
                <div class="border"></div>
                <p class="question_number">Q1:</p>
                <p class="question_content">不同種類的交通工具的碳排差多少?app是如何判斷的呢?</p>
            </div>
            <div class="answer">
                <p class="answer_number">A1:</p>
                <p class="answer_content">一般汽車的碳排約是147gCO2e/km
                    機車分成一般及電動機車
                    自行車
                    步行
                    app採測速功能判別使用者的移動工具
                </p>
            </div>
        </div>
    </div>

    <div id="menu_list">
        <div id="home_tab" class="menu">
            <a href="#home">首頁</a>
        </div>
        <div id="notification_tab" class="menu">
            <a href="#notification">通知</a>
        </div>
        <div id="reward_tab" class="menu">
            <a href="#reward">獎勵領取</a>
        </div>
        <div id="rank_tab" class="menu">
            <a href="#rank">排行榜</a>
        </div>
        <div id="knowledge_tab" class="menu">
            <a href="#knowledge">知識專區</a>
        </div>
        <div id="QA_tab" class="menu">
            <a href="#QA">Q&A</a>
        </div>
        <div id="logout_tab" class="menu" onclick="logOut()">
            <a>登出</a>
        </div>
    </div>


    <!-- <form onsubmit="return send()" method="POST">
            <p><input id="chosen-file" type="file" value="choose file" accept=".zip,.rar,.7zip" /></p>
            <p><input type="submit" value="Submit" /></p>
        </form> -->


    <script src="./src/app.js"></script>
    <script src="./src/register.js"></script>
    <script>
        let slideIndex = 1;
        showSlides(slideIndex);

        function currentSlide(n) {
            showSlides(slideIndex = n);
        }

        function showSlides(n) {
            let i;
            let slides = document.getElementsByClassName("mySlides");
            let dots = document.getElementsByClassName("dot");
            if (n > slides.length) { slideIndex = 1 }
            if (n < 1) { slideIndex = slides.length }
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            for (i = 0; i < dots.length; i++) {
                dots[i].className = dots[i].className.replace(" active", "");
            }
            slides[slideIndex - 1].style.display = "block";
            dots[slideIndex - 1].className += " active";
        }
    </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        var data, chartOptions;

        function drawChart() {
            data = google.visualization.arrayToDataTable([
                ['Type', 'Distance'],
                ['汽車', 30],
                ['走路', 25],
                ['腳踏車', 35],
                ['機車', 10],
            ]);

            chartOptions = {
                pieHole: 0.4,
                legend: {
                    position: 'labeled',
                    textStyle: {
                        fontName: 'DM Sans'
                    }
                },
                slices: {
                    0: { color: '#1E8981' },
                    1: { color: '#5CA6A1' },
                    2: { color: '#8EC3C1' },
                    3: { color: '#BEE0E1' },
                },
                chartArea: {
                    left: 'calc((100vw - 274px)/2)', top: '5%', width: '80%', height: '80%'
                },
                pieSliceTextStyle: {
                    color: 'black',
                    fontName: 'DM Sans'
                }
            };
        }

        var chartFirstClick = true;

        function drawDonut() {
            if (chartFirstClick) {
                var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
                chart.draw(data, chartOptions);
                chartFirstClick = false;
            }
        }
    </script>
    <script>

        var tableFirstClick = true;
        var todayTD;
        function drawTable() {
            const today = new Date()
            let todayDate = today.getDate()

            const firstDate = new Date()
            firstDate.setDate(1)
            let firstWeekday = firstDate.getDay()

            firstWeekday -= 1
            if (firstWeekday == -1) {
                firstWeekday = 6;
            }

            if (tableFirstClick) {
                let i = 0;
                dates_img = document.querySelectorAll("#checkin_table td img")
                for (i = firstWeekday; i < todayDate + firstWeekday - 1; i++) {
                    dates_img[i].style.display = "block";
                }
                todayTD = document.querySelectorAll("#checkin_table td")[i]
                todayTD.style.backgroundColor = "#b8e6e3";

                tableFirstClick = false;
            }

        }
    </script>
    <script>
        function send() {
            let chosen_file = document.getElementById("chosen-file").files[0];
            //console.log(chosen_file)
            let formData = new FormData();

            formData.append("file", chosen_file);
            fetch('/upload', { method: "POST", body: formData })
                .then((response) => {
                    console.log(response.json());
                }).catch((error) => {
                    console.log(error);
                });
            return false
        }
    </script>


    <!-- <script>
        var width = 320;
        var height = 0;

        var streaming = false;

        var video = document.getElementById('scanner');

        navigator.mediaDevices.getUserMedia({
            video: { facingMode: { exact: "environment" } },
            audio: false
        })
            // on success, stream it in video tag
            .then(function (stream) {
                video.srcObject = stream;
                video.play();
            })
            .catch(function (err) {
                console.log("An error occurred: " + err);
            });

        video.addEventListener('canplay', function (ev) {
            if (!streaming) {
                height = video.videoHeight / (video.videoWidth / width);

                if (isNaN(height)) {
                    height = width / (4 / 3);
                }

                video.setAttribute('width', width);
                video.setAttribute('height', height);
                streaming = true;
            }
        }, false);
    </script> -->
</body>